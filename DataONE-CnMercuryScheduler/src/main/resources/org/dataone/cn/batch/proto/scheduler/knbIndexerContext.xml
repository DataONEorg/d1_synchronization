<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : knbIndexerContext.xml
    Created on : July 23, 2010, 12:58 AM
    Author     : rwaltz
    Description:
        Purpose of the document follows.
-->

<beans default-init-method="init" xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-2.5.xsd">

    <bean id="knbTransactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <bean id="knbDocumentDatabaseTarget" class="index_utils.DefaultDocumentDatabase">
        <property name="dataSource" ref="dataSource"/>
        <property name="solrPostURL">
            <value>${mercury3.solrPostURL}</value>
        </property>
        <property name="solrdb">
            <value>${mercury3.solrdb}</value>
        </property>
        <property name="source">
            <value>knb</value>
        </property>
        <property name="instance">
            <value>${mercury3.instance}</value>
        </property>
    </bean>

    <bean id="knbDocumentDatabase" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
        <property name="transactionManager" ref="knbTransactionManager"/>
        <property name="target" ref="knbDocumentDatabaseTarget"/>
        <property name="transactionAttributes">
            <props>
                <prop key="getSources">PROPAGATION_REQUIRED,readOnly</prop>
            </props>
        </property>
    </bean>

    <bean id="knbSolrXPathPrototype" class="org.dataone.cn.mercury.Solr_XPath_Prototype">
        <constructor-arg index="0" >
            <ref bean="eml" />
        </constructor-arg>
        <constructor-arg index="1">
            <ref bean="dataoneMercuryNamespaceContext"/>
        </constructor-arg>
    </bean>
    <bean id="knbXpathHandler" class="org.dataone.cn.mercury.XPath_Handler">
        <property name="lookupProperties">
            <ref bean="emlLookupProperties"/>
        </property>
        <property name="spe">
            <ref bean="knbSolrXPathPrototype"/>
        </property>
    </bean>

    <bean id="knbIndexer" class="org.dataone.cn.mercury.Indexer">
        <property name="instance"><value>${mercury3.instance}</value></property>
        <property name="source"><value>knb</value></property>
        <property name="solrdb"><value>${mercury3.solrdb}</value></property>
        <property name="solrPostURL"><value>${mercury3.solrPostURL}</value></property>
        <property name="sxp">
            <ref bean="knbSolrXPathPrototype" />
        </property>
        <property name="xpathHandler">
            <ref bean="knbXpathHandler" />
        </property>
        <property name="traceList">
        <ref bean="testFileInfo" />
        </property>
        <property name="documentDatabase">
            <ref bean="knbDocumentDatabase" />
        </property>
    </bean>

</beans>
