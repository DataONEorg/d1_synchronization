<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : services.xml
    Created on : June 4, 2010, 1:58 AM
    Author     : rwaltz
    Description:
        Purpose of the document follows.
-->

<beans default-init-method="init" xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">

<!-- the bean to be created via the factory bean -->

    <bean id="biBimBob" class="org.dataone.cn.jjigae.BiBimBob" />

    <bean id="cnClient" class="org.dataone.client.CNode">
        <constructor-arg type="java.lang.String" value="${cnClient.contextRootUrl}" />
    </bean>

    <bean id="mnNodeBaseUrl"
      factory-bean="mnNodeReferenceUtility"
      factory-method="getNodeBaseURL"/>

    <bean id="mnClient" class="org.dataone.client.MNode">
        <constructor-arg type="java.lang.String" ref="mnNodeBaseUrl" />
    </bean>

    <bean id="cnToken"  class="org.dataone.service.types.AuthToken" />

    <bean id="publicToken"  class="org.dataone.service.types.AuthToken">
        <constructor-arg type="java.lang.String" value="public"/>
    </bean>

    <bean id="objectListQueue" class="org.dataone.cn.batch.proto.harvest.ObjectListQueueBuilder">
        <property name="mnReader" ref="mnClient"/>
        <property name="token" ref="publicToken" />
        <property name="nodeReferenceUtility" ref="mnNodeReferenceUtility" />
    </bean>

    <bean id="objectListProcessor" class="org.dataone.cn.batch.proto.harvest.ObjectListQueueProcessor">
        <property name="mnReader" ref="mnClient" />
        <property name="token" ref="cnToken" />
        <property name="mnIdentifier" value="${synchronize.mnIdentifier}" />
    </bean>
    <bean id="objectListWriter" class="org.dataone.cn.batch.proto.harvest.ObjectListQueueWriter">
        <property name="mnReader" ref="mnClient" />
        <property name="cnWriter" ref="cnClient" />
        <property name="cnAuthorization" ref="cnClient" />
        <property name="token" ref="cnToken" />
        <property name="validSciMetaObjectFormats" ref="validScienceMetadataFormats" />
        <property name="nodeReferenceUtility" ref="mnNodeReferenceUtility" />
        <property name="nodeListAccess" ref="nodeListAccess" />
    </bean>
<!-- the last step in this pipeline should be to update the node list so that the synchronized date is set -->

</beans>
